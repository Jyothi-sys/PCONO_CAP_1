var that;sap.ui.define(["sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/export/Spreadsheet","sap/m/BusyDialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/Token","sap/ui/model/Sorter"],function(e,t,a,r,i,o,n,d,l,s,u,c){"use strict";that=this;return{storeView_cityCode:function(e,t){this.currentView=e;that.GlbCurrView=t;that.GlbCurrView.busy=new n},handleCityCodeSelectionChange:function(e){var t=e.getParameter("changedItem"),a=e.getParameter("selected"),r=t.getBindingContext("columndataCityCodeTable");r.oModel.setProperty(r.sPath+"/visible",a);r.oModel.refresh(true)},onRead_CityCodeTableData:function(){var e=this.currentView.getOwnerComponent().getModel("masterDataGlobalModel");var t=new sap.ui.model.json.JSONModel;e.callFunction("/userInfo",{success:function(e){t.setData(e.userInfo.scopes);that.getView().setModel(t,"userModel");that.userLoggedIn=e.userInfo.user}.bind(that),error:function(e){}.bind(that)});e.read("/z_city_code",{success:function(e){var t=that.getView().getModel("userModel").getData();if(t.TISAdmin===true){var a=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"MM-dd-yyyy"});var r=a.format(new Date);for(var i=0;i<e.results.length;i++){e.results[i].changed_on=a.format(e.results[i].changed_on);e.results[i].created_on=a.format(e.results[i].created_on);e.results[i].change_time=new Date(e.results[i].change_time.ms).toISOString().slice(11,19);e.results[i].created_time=new Date(e.results[i].created_time.ms).toISOString().slice(11,19)}that.GlbCurrView.getView().setModel(new sap.ui.model.json.JSONModel(e.results),"globalMainData_CityCode");that.GlbCurrView.getView().setModel(new sap.ui.model.json.JSONModel(e.results),"cityCode_Model")}else{that.getView().setModel([],"globalMainData_CityCode")}},error:function(e){that.GlbCurrView.busy.close()}})},setMaxDate_City:function(){var e=new Date;var t=e.setDate(e.getDate());t=new Date(t).getDate();t=t.toString().padStart(2,"0");var a=e.getMonth()+1;a=a.toString().padStart(2,"0");var r=e.getFullYear().toString();that.GlbCurrView.completeDate=a+"-"+t+"-"+r;const i=new Date(r,a-1,t);var o=this.currentView.getView().byId("id_datePicker_1");o.setMaxDate(i)},setMaxDate_City2:function(){var e=new Date;var t=e.setDate(e.getDate());t=new Date(t).getDate();t=t.toString().padStart(2,"0");var a=e.getMonth()+1;a=a.toString().padStart(2,"0");var r=e.getFullYear().toString();that.GlbCurrView.completeDate1=a+"-"+t+"-"+r;const i=new Date(r,a-1,t);var o=this.currentView.getView().byId("id_datePicker2");o.setMaxDate(i)},handleChangeCreatedOnDateUtil:function(e){that.startDate=e.mParameters.value.substr(0,10);that.endDate=e.mParameters.value.substr(13,20)},handleChangedOnDateUtil:function(e){that.startDate1=e.mParameters.value.substr(0,10);that.endDate1=e.mParameters.value.substr(13,20)},handleCityTableSortButtonPressedUtil:function(e){if(this.currentView.oCityCode_SortFrag){this.currentView.oCityCode_SortFrag=undefined}if(!this.currentView.oCityCode_SortFrag){that.GlbCurrView.busy.open();this.currentView.oCityCode_SortFrag=sap.ui.xmlfragment("masterdata.fragments.dialogs.citycode.ascAndDscSort_CityCode",that);this.currentView.getView().addDependent(that.GlbCurrView.oCityCode_SortFrag)}that.GlbCurrView.busy.close();this.currentView.oCityCode_SortFrag.open()},getDefaultFilteredDateData:function(){var e=this.currentView.byId("id_City_Code_Table");var t=e.getBinding("items");var a=[];a.push(new c("transmissionDate",true));t.sort(a)},CityCode_handleSortDialogConfirm:function(e){var t=this.currentView.byId("id_City_Code_Table"),a=e.getParameters(),r=t.getBinding("items"),i,o,n=[];i=a.sortItem.getKey();o=a.sortDescending;n.push(new c(i,o));r.sort(n)},VisibleColumns_cityCode:function(){var t=jQuery.sap.getResourcePath("masterdata/model")+"/cityCodeTableColumns.json";var a=new e;a.loadData(t).then(function(){this.currentView.getView().setModel(a,"columndataCityCodeTable");this.currentView.getView().byId("id_CityCodeTable").setSelectedKeys(["city_code","lang","area_code","country_code","city_name","short_name","created_on","created_time","changed_on","change_time","legacy_information","sap_city"])}.bind(this))},onOpenCityCodeTableFragment_CityCodeUtil:function(t){if(this.currentView.oCityCode_Frag){this.currentView.oCityCode_Frag=undefined}if(!this.currentView.oCityCode_Frag){that.GlbCurrView.busy.open();this.currentView.oCityCode_Frag=sap.ui.xmlfragment("masterdata.fragments.dialogs.citycode.cityCode",that.GlbCurrView);this.currentView.getView().addDependent(that.GlbCurrView.oCityCode_Frag);var a=that.GlbCurrView.getView().getModel("globalMainData_CityCode").oData;var r={};var i=a;var o=[];for(var n,d=0;n=i[d++];){var l=n.city_code;if(!(l in r)){r[l]=1;o.push({city_code:l})}}var s=new e(o);this.currentView.getView().setModel(s,"city_code_GlobalData");this.currentView.oCityCode_Frag.setModel(s,"city_code_Data")}that.GlbCurrView.busy.close();this.currentView.oCityCode_Frag.open()},onSelectionCityCodeUtil:function(e){var t=e.getParameter("selectedContexts");var a=this.currentView.getView().byId("id_CityCodes");var r=[];var i=this.currentView.getView().getModel("city_code_GlobalData");for(var o=0;o<t.length;o++){r.push(t[o])}that.GlbCurrView.ocity_code_Model=[];$.each(r,function(e,t){if($.inArray(t.ProductId,that.GlbCurrView.ocity_code_Model)===-1)that.GlbCurrView.ocity_code_Model.push(t.getObject())});i.setProperty("/tokens1",that.GlbCurrView.ocity_code_Model);var n;n=a.getTokens()[0];if(!n){n=new u({text:"{city_code}",key:"{city_code}"})}else{n=a.getTokens()[0].clone()}that.GlbCurrView.ocity_code_Model.forEach(function(e){a.addToken(new u({text:e.city_code}))})},onSearchCityCodeUtil:function(e){var t=e.getParameter("value");var a=new d("city_code",sap.ui.model.FilterOperator.Contains,t);var r=e.getParameter("itemsBinding");r.filter([a])},onDialogClose_CityCodeUtil:function(e){if(that.GlbCurrView.oCityCode_Frag){that.GlbCurrView.oCityCode_Frag=undefined;that.GlbCurrView.oCityCode_Frag=null}},onGoToReport_CityCodeUtil:function(){that.GlbCurrView.busy.open();var t=this.currentView.getView().byId("id_CityCodes").getTokens();that.GlbCurrView.sCityCodeTable_code_TokensValues=t.map(function(e){return e.getText()}).join(",");var a=[];if(that.GlbCurrView.sCityCodeTable_code_TokensValues!==""){var r=that.GlbCurrView.sCityCodeTable_code_TokensValues.split(",");if(r.length>0){$.each(r,function(e,t){a.push(new sap.ui.model.Filter("city_code",sap.ui.model.FilterOperator.Contains,t))})}}if(that.startDate!==""&&that.endDate!==""||that.startDate!==undefined&&that.endDate!==undefined){var i=that.startDate;var o=that.endDate;if(i){a.push(new sap.ui.model.Filter("created_on",sap.ui.model.FilterOperator.BT,i,o))}}if(that.startDate1!==""&&that.endDate1!==""||that.startDate1!==undefined&&that.endDate1!==undefined){var n=that.startDate1;var d=that.endDate1;if(n){a.push(new sap.ui.model.Filter("changed_on",sap.ui.model.FilterOperator.BT,n,d))}}that.GlbCurrView.tableMainModelfiltereddata=undefined;that.GlbCurrView.tableMainModelfiltereddata=new e(that.GlbCurrView.getView().getModel("globalMainData_CityCode").oData);that.GlbCurrView.getView().setModel(that.GlbCurrView.tableMainModelfiltereddata,"cityCode_Model");this.currentView.getView().byId("id_City_Code_Table").getBinding("items").filter(a);that.GlbCurrView.filteredData=true;that.GlbCurrView.filteredDataToExport=[];var l=this.currentView.getView().byId("id_City_Code_Table").getBinding("items").aIndices.length;that.GlbCurrView.filteredIndices=this.currentView.getView().byId("id_City_Code_Table").getBinding("items").aIndices;for(var s=0;s<l;s++){that.GlbCurrView.filteredDataToExport.push(that.GlbCurrView.tableMainModelfiltereddata.oData[that.GlbCurrView.filteredIndices[s]])}var u=new e(that.GlbCurrView.filteredDataToExport);that.GlbCurrView.getView().setModel(u,"cityCode_Model");that.GlbCurrView.busy.close()},onCityCodeExportExcel:function(e){var t=new sap.ui.model.json.JSONModel(that.GlbCurrView.getView().getModel("cityCode_Model").oData);var a=[{label:"City Code",property:"city_code"},{label:"Lang",property:"lang"},{label:"Area Code",property:"area_code"},{label:"Country Code",property:"country_code"},{label:"City Name",property:"city_name"},{label:"Short Name",property:"short_name"},{label:"Created On",property:"created_on"},{label:"Created Time",property:"created_time"},{label:"Changed On",property:"changed_on"},{label:"Change Time",property:"change_time"},{label:"Legacy Information",property:"legacy_information"},{label:"SAP City",property:"sap_city"},{label:"Created By",property:"created_by"},{label:"Changed By",property:"changed_by"}];var r={workbook:{columns:a,context:{sheetName:"City_Code_Table"}},dataSource:t.getData(),fileName:"City_Code_Table.xlsx"};var i=new sap.ui.export.Spreadsheet(r);i.build().then(function(){i.destroy()})},onClearCityCodeUtil:function(e){that.GlbCurrView.filteredData=false;this.currentView.getView().byId("id_CityCodes").setTokens([]);this.currentView.getView().byId("id_datePicker_1").setValue("");this.currentView.getView().byId("id_datePicker2").setValue("");var t=new sap.ui.model.json.JSONModel;that.getView().setModel(t,"cityCode_Model");that.GlbCurrView.completeDate="";that.GlbCurrView.completeDate1="";that.startDate="";that.endDate="";that.startDate1="";that.endDate1=""}}});