var that;sap.ui.define(["sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/export/Spreadsheet","sap/m/BusyDialog","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/Token","sap/ui/model/Sorter"],function(e,r,t,a,o,n,i,l,d,u,s,c){"use strict";that=this;return{storeView:function(e,r){this.currentView=e;that.GlbCurrView=r;that.GlbCurrView.busy=new i},trdPartVisibleColumns:function(){var r=jQuery.sap.getResourcePath("masterdata/model")+"/tradingPartnerColumns.json";var t=new e;t.loadData(r).then(function(){this.currentView.getView().setModel(t,"columndataTrdPart");this.currentView.getView().byId("id_showHideColumns").setSelectedKeys(["customer_number","parent_code","company_class","area","country_code","short_name","global_group_code","created_on","changed_on"])}.bind(this))},handleTrdPartSelectionChangeUtil:function(e){var r=e.getParameter("changedItem"),t=e.getParameter("selected"),a=r.getBindingContext("columndataTrdPart");a.oModel.setProperty(a.sPath+"/visible",t);a.oModel.refresh(true)},setMaxDate_TrdPart:function(){var e=new Date;var r=e.setDate(e.getDate());r=new Date(r).getDate();r=r.toString().padStart(2,"0");var t=e.getMonth()+1;t=t.toString().padStart(2,"0");var a=e.getFullYear().toString();that.GlbCurrView.completeDate=t+"-"+r+"-"+a;const o=new Date(a,t-1,r);var n=this.currentView.getView().byId("id_datePickerTrdPart");n.setMaxDate(o)},setMaxDate_TrdPart2:function(){var e=new Date;var r=e.setDate(e.getDate());r=new Date(r).getDate();r=r.toString().padStart(2,"0");var t=e.getMonth()+1;t=t.toString().padStart(2,"0");var a=e.getFullYear().toString();that.GlbCurrView.completeDate1=t+"-"+r+"-"+a;const o=new Date(a,t-1,r);var n=this.currentView.getView().byId("id_datePicker_TrdPart_3");n.setMaxDate(o)},onClearTrdPartUtil:function(e){that.GlbCurrView.filteredData=false;this.currentView.getView().byId("id_datePickerTrdPart").setValue("");this.currentView.getView().byId("id_datePicker_TrdPart_3").setValue("");this.currentView.getView().byId("id_customer_number_TrdPart").setTokens([]);this.currentView.getView().byId("id_company_class_TrdPart").setTokens([]);this.currentView.getView().byId("id_area_TrdPart").setTokens([]);this.currentView.getView().byId("id_country_code_TrdPart").setTokens([]);this.currentView.getView().byId("id_global_group_code_TrdPart").setTokens([]);var r=new sap.ui.model.json.JSONModel;that.getView().setModel(r,"TradingPartnerModel");that.GlbCurrView.completeDate="";that.GlbCurrView.completeDate1="";that.startDate="";that.endDate="";that.startDate1="";that.endDate1=""},onReadTradingPartnerTableData:function(){var e=this.currentView.getOwnerComponent().getModel("masterDataGlobalModel");var r=new sap.ui.model.json.JSONModel;e.callFunction("/userInfo",{success:function(e){r.setData(e.userInfo.scopes);that.getView().setModel(r,"userModel");that.userLoggedIn=e.userInfo.user}.bind(that),error:function(e){}.bind(that)});e.read("/zumm_trd_partner",{success:function(e){var r=that.getView().getModel("userModel").getData();if(r.TISAdmin===true){var t=sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"MM-dd-yyyy"});var a=t.format(new Date);for(var o=0;o<e.results.length;o++){e.results[o].changed_on=t.format(e.results[o].changed_on);e.results[o].created_on=t.format(e.results[o].created_on);e.results[o].change_time=new Date(e.results[o].change_time.ms).toISOString().slice(11,19);e.results[o].created_time=new Date(e.results[o].created_time.ms).toISOString().slice(11,19)}that.GlbCurrView.getView().setModel(new sap.ui.model.json.JSONModel(e.results),"globalMainData_TrdPart");that.GlbCurrView.getView().setModel(new sap.ui.model.json.JSONModel(e.results),"TradingPartnerModel")}else{that.getView().setModel([],"globalMainData_TrdPart")}},error:function(e){that.GlbCurrView.busy.close()}})},handleDateChangedOnTrpPartUtil:function(e){that.startDate=e.mParameters.value.substr(0,10);that.endDate=e.mParameters.value.substr(13,20)},handleChangeCreatedOnTrpPartUtil:function(e){that.startDate1=e.mParameters.value.substr(0,10);that.endDate1=e.mParameters.value.substr(13,20)},onOpencustomer_numberFragment_Util_TrpPart:function(r){if(this.currentView.ocustomer_number_TrdPart_Frag){this.currentView.ocustomer_number_TrdPart_Frag=undefined}if(!this.currentView.ocustomer_number_TrdPart_Frag){that.GlbCurrView.busy.open();this.currentView.ocustomer_number_TrdPart_Frag=sap.ui.xmlfragment("masterdata.fragments.dialogs.TrdPart.customer_number_TrdPart",that.GlbCurrView);this.currentView.getView().addDependent(that.GlbCurrView.ocustomer_number_TrdPart_Frag);var t=that.GlbCurrView.getView().getModel("globalMainData_TrdPart").oData;var a={};var o=t;var n=[];for(var i,l=0;i=o[l++];){var d=i.customer_number;if(!(d in a)){a[d]=1;n.push({customer_number:d})}}var u=new e(n);this.currentView.getView().setModel(u,"customer_numberTrdPartGlobalData");this.currentView.ocustomer_number_TrdPart_Frag.setModel(u,"customer_numberTrdPartData")}that.GlbCurrView.busy.close();this.currentView.ocustomer_number_TrdPart_Frag.open()},onSelectioncustomer_number_Util_TrpPart:function(e){var r=e.getParameter("selectedContexts");var t=this.currentView.getView().byId("id_customer_number_TrdPart");var a=[];var o=this.currentView.getView().getModel("customer_numberTrdPartGlobalData");for(var n=0;n<r.length;n++){a.push(r[n])}that.GlbCurrView.ocustomer_numberTrdPartModel=[];$.each(a,function(e,r){if($.inArray(r.ProductId,that.GlbCurrView.ocustomer_numberTrdPartModel)===-1)that.GlbCurrView.ocustomer_numberTrdPartModel.push(r.getObject())});o.setProperty("/tokens1",that.GlbCurrView.ocustomer_numberTrdPartModel);var i;i=t.getTokens()[0];if(!i){i=new s({text:"{customer_number}",key:"{customer_number}"})}else{i=t.getTokens()[0].clone()}that.GlbCurrView.ocustomer_numberTrdPartModel.forEach(function(e){t.addToken(new s({text:e.customer_number}))})},onSearchcustomer_number_Util_TrpPart:function(e){var r=e.getParameter("value");var t=new l("customer_number",sap.ui.model.FilterOperator.Contains,r);var a=e.getParameter("itemsBinding");a.filter([t])},onOpencompany_classFragment_Util_TrpPart:function(r){if(this.currentView.ocompany_class_TrdPart_Frag){this.currentView.ocompany_class_TrdPart_Frag=undefined}if(!this.currentView.ocompany_class_TrdPart_Frag){that.GlbCurrView.busy.open();this.currentView.ocompany_class_TrdPart_Frag=sap.ui.xmlfragment("masterdata.fragments.dialogs.TrdPart.company_class_TrdPart",that.GlbCurrView);this.currentView.getView().addDependent(that.GlbCurrView.ocompany_class_TrdPart_Frag);var t=that.GlbCurrView.getView().getModel("globalMainData_TrdPart").oData;var a={};var o=t;var n=[];for(var i,l=0;i=o[l++];){var d=i.company_class;if(!(d in a)){a[d]=1;n.push({company_class:d})}}var u=new e(n);this.currentView.getView().setModel(u,"company_classTrdPartGlobalData");this.currentView.ocompany_class_TrdPart_Frag.setModel(u,"company_classTrdPartData")}that.GlbCurrView.busy.close();this.currentView.ocompany_class_TrdPart_Frag.open()},onSelectioncompany_class_Util_TrpPart:function(e){var r=e.getParameter("selectedContexts");var t=this.currentView.getView().byId("id_company_class_TrdPart");var a=[];var o=this.currentView.getView().getModel("company_classTrdPartGlobalData");for(var n=0;n<r.length;n++){a.push(r[n])}that.GlbCurrView.ocompany_classTrdPartModel=[];$.each(a,function(e,r){if($.inArray(r.ProductId,that.GlbCurrView.ocompany_classTrdPartModel)===-1)that.GlbCurrView.ocompany_classTrdPartModel.push(r.getObject())});o.setProperty("/tokens1",that.GlbCurrView.ocompany_classTrdPartModel);var i;i=t.getTokens()[0];if(!i){i=new s({text:"{company_class}",key:"{company_class}"})}else{i=t.getTokens()[0].clone()}that.GlbCurrView.ocompany_classTrdPartModel.forEach(function(e){t.addToken(new s({text:e.company_class}))})},onSearchcompany_class_Util_TrpPart:function(e){var r=e.getParameter("value");var t=new l("company_class",sap.ui.model.FilterOperator.Contains,r);var a=e.getParameter("itemsBinding");a.filter([t])},onOpenareaFragment_Util_TrpPart:function(r){if(this.currentView.oarea_TrdPart_Frag){this.currentView.oarea_TrdPart_Frag=undefined}if(!this.currentView.oarea_TrdPart_Frag){that.GlbCurrView.busy.open();this.currentView.oarea_TrdPart_Frag=sap.ui.xmlfragment("masterdata.fragments.dialogs.TrdPart.area_TrdPart",that.GlbCurrView);this.currentView.getView().addDependent(that.GlbCurrView.oarea_TrdPart_Frag);var t=that.GlbCurrView.getView().getModel("globalMainData_TrdPart").oData;var a={};var o=t;var n=[];for(var i,l=0;i=o[l++];){var d=i.area;if(!(d in a)){a[d]=1;n.push({area:d})}}var u=new e(n);this.currentView.getView().setModel(u,"areaTrdPartGlobalData");this.currentView.oarea_TrdPart_Frag.setModel(u,"areaTrdPartData")}that.GlbCurrView.busy.close();this.currentView.oarea_TrdPart_Frag.open()},onSelectionarea_Util_TrpPart:function(e){var r=e.getParameter("selectedContexts");var t=this.currentView.getView().byId("id_area_TrdPart");var a=[];var o=this.currentView.getView().getModel("areaTrdPartGlobalData");for(var n=0;n<r.length;n++){a.push(r[n])}that.GlbCurrView.oareaTrdPartModel=[];$.each(a,function(e,r){if($.inArray(r.ProductId,that.GlbCurrView.oareaTrdPartModel)===-1)that.GlbCurrView.oareaTrdPartModel.push(r.getObject())});o.setProperty("/tokens1",that.GlbCurrView.oareaTrdPartModel);var i;i=t.getTokens()[0];if(!i){i=new s({text:"{area}",key:"{area}"})}else{i=t.getTokens()[0].clone()}that.GlbCurrView.oareaTrdPartModel.forEach(function(e){t.addToken(new s({text:e.area}))})},onSearcharea_Util_TrpPart:function(e){var r=e.getParameter("value");var t=new l("area",sap.ui.model.FilterOperator.Contains,r);var a=e.getParameter("itemsBinding");a.filter([t])},onOpencountry_codeFragment_Util_TrpPart:function(r){if(this.currentView.ocountry_code_TrdPart_Frag){this.currentView.ocountry_code_TrdPart_Frag=undefined}if(!this.currentView.ocountry_code_TrdPart_Frag){that.GlbCurrView.busy.open();this.currentView.ocountry_code_TrdPart_Frag=sap.ui.xmlfragment("masterdata.fragments.dialogs.TrdPart.country_code_TrdPart",that.GlbCurrView);this.currentView.getView().addDependent(that.GlbCurrView.ocountry_code_TrdPart_Frag);var t=that.GlbCurrView.getView().getModel("globalMainData_TrdPart").oData;var a={};var o=t;var n=[];for(var i,l=0;i=o[l++];){var d=i.country_code;if(!(d in a)){a[d]=1;n.push({country_code:d})}}var u=new e(n);this.currentView.getView().setModel(u,"country_codeTrdPartGlobalData");this.currentView.ocountry_code_TrdPart_Frag.setModel(u,"country_codeTrdPartData")}that.GlbCurrView.busy.close();this.currentView.ocountry_code_TrdPart_Frag.open()},onSelectioncountry_code_Util_TrpPart:function(e){var r=e.getParameter("selectedContexts");var t=this.currentView.getView().byId("id_country_code_TrdPart");var a=[];var o=this.currentView.getView().getModel("country_codeTrdPartGlobalData");for(var n=0;n<r.length;n++){a.push(r[n])}that.GlbCurrView.ocountry_codeTrdPartModel=[];$.each(a,function(e,r){if($.inArray(r.ProductId,that.GlbCurrView.ocountry_codeTrdPartModel)===-1)that.GlbCurrView.ocountry_codeTrdPartModel.push(r.getObject())});o.setProperty("/tokens1",that.GlbCurrView.ocountry_codeTrdPartModel);var i;i=t.getTokens()[0];if(!i){i=new s({text:"{country_code}",key:"{country_code}"})}else{i=t.getTokens()[0].clone()}that.GlbCurrView.ocountry_codeTrdPartModel.forEach(function(e){t.addToken(new s({text:e.country_code}))})},onSearchcountry_code_Util_TrpPart:function(e){var r=e.getParameter("value");var t=new l("country_code",sap.ui.model.FilterOperator.Contains,r);var a=e.getParameter("itemsBinding");a.filter([t])},onOpenglobal_group_codeFragment_Util_TrpPart:function(r){if(this.currentView.oglobal_group_code_TrdPart_Frag){this.currentView.oglobal_group_code_TrdPart_Frag=undefined}if(!this.currentView.oglobal_group_code_TrdPart_Frag){that.GlbCurrView.busy.open();this.currentView.oglobal_group_code_TrdPart_Frag=sap.ui.xmlfragment("masterdata.fragments.dialogs.TrdPart.global_group_code_TrdPart",that.GlbCurrView);this.currentView.getView().addDependent(that.GlbCurrView.oglobal_group_code_TrdPart_Frag);var t=that.GlbCurrView.getView().getModel("globalMainData_TrdPart").oData;var a={};var o=t;var n=[];for(var i,l=0;i=o[l++];){var d=i.global_group_code;if(!(d in a)){a[d]=1;n.push({global_group_code:d})}}var u=new e(n);this.currentView.getView().setModel(u,"global_group_codeTrdPartGlobalData");this.currentView.oglobal_group_code_TrdPart_Frag.setModel(u,"global_group_codeTrdPartData")}that.GlbCurrView.busy.close();this.currentView.oglobal_group_code_TrdPart_Frag.open()},onSelectionglobal_group_code_Util_TrpPart:function(e){var r=e.getParameter("selectedContexts");var t=this.currentView.getView().byId("id_global_group_code_TrdPart");var a=[];var o=this.currentView.getView().getModel("global_group_codeTrdPartGlobalData");for(var n=0;n<r.length;n++){a.push(r[n])}that.GlbCurrView.oglobal_group_codeTrdPartModel=[];$.each(a,function(e,r){if($.inArray(r.ProductId,that.GlbCurrView.oglobal_group_codeTrdPartModel)===-1)that.GlbCurrView.oglobal_group_codeTrdPartModel.push(r.getObject())});o.setProperty("/tokens1",that.GlbCurrView.oglobal_group_codeTrdPartModel);var i;i=t.getTokens()[0];if(!i){i=new s({text:"{global_group_code}",key:"{global_group_code}"})}else{i=t.getTokens()[0].clone()}that.GlbCurrView.oglobal_group_codeTrdPartModel.forEach(function(e){t.addToken(new s({text:e.global_group_code}))})},onSearchglobal_group_code_Util_TrpPart:function(e){var r=e.getParameter("value");var t=new l("global_group_code",sap.ui.model.FilterOperator.Contains,r);var a=e.getParameter("itemsBinding");a.filter([t])},onCloseDialog_Util_TradPart:function(e){if(that.GlbCurrView.ocustomer_number_TrdPart_Frag){that.GlbCurrView.ocustomer_number_TrdPart_Frag=undefined;that.GlbCurrView.ocustomer_number_TrdPart_Frag=null}if(that.GlbCurrView.ocompany_class_TrdPart_Frag){that.GlbCurrView.ocompany_class_TrdPart_Frag=undefined;that.GlbCurrView.ocompany_class_TrdPart_Frag=null}if(that.GlbCurrView.oarea_TrdPart_Frag){that.GlbCurrView.oarea_TrdPart_Frag=undefined;that.GlbCurrView.oarea_TrdPart_Frag=null}if(that.GlbCurrView.ocountry_code_TrdPart_Frag){that.GlbCurrView.ocountry_code_TrdPart_Frag=undefined;that.GlbCurrView.ocountry_code_TrdPart_Frag=null}if(that.GlbCurrView.oglobal_group_code_TrdPart_Frag){that.GlbCurrView.oglobal_group_code_TrdPart_Frag=undefined;that.GlbCurrView.oglobal_group_code_TrdPart_Frag=null}},onExportSelectedTrdPartTable:function(e){var r=this.currentView.getView().byId("idTrdPartTable").getSelectedItems().length;var t=new sap.ui.model.json.JSONModel(that.GlbCurrView.getView().getModel("TradingPartnerModel").oData);var a=[{label:"Customer Number",property:"customer_number"},{label:"Status",property:"status"},{label:"Date",property:"date"},{label:"Parent Code",property:"parent_code"},{label:"Company Class",property:"company_class"},{label:"Area",property:"area"},{label:"Country Code",property:"country_code"},{label:"City Code",property:"city_code"},{label:"Name1",property:"name1"},{label:"Name2",property:"name2"},{label:"Short Name",property:"short_name"},{label:"Address Line1",property:"address_line1"},{label:"Address Line2",property:"address_line2"},{label:"Consolidated",property:"consolidated"},{label:"Telephone Number",property:"telephone_number"},{label:"Fax Number",property:"fax_number"},{label:"Telex Number",property:"telex_number"},{label:"Procurement Flag",property:"procurement_flag"},{label:"Deletion Indicator",property:"deletion_indicator"},{label:"Created On",property:"created_on"},{label:"Created Time",property:"created_time"},{label:"Changed On",property:"changed_on"},{label:"Changed Time",property:"changed_time"},{label:"Global Group Code",property:"global_group_code"},{label:"Created By",property:"created_by"},{label:"Changed By",property:"changed_by"}];var o={workbook:{columns:a,context:{sheetName:"TradingPartner"}},dataSource:t.getData(),fileName:"TradingPartner.xlsx"};var n=new sap.ui.export.Spreadsheet(o);n.build().then(function(){n.destroy()})},onGoToReport_Util_TrdPart:function(){that.GlbCurrView.busy.open();var r=this.currentView.getView().byId("id_customer_number_TrdPart").getTokens();that.GlbCurrView.sTrdPart_customer_number_TokensValues=r.map(function(e){return e.getText()}).join(",");var t=this.currentView.getView().byId("id_company_class_TrdPart").getTokens();that.GlbCurrView.sTrdPart_TrdPart_company_class_Tokens_Values=t.map(function(e){return e.getText()}).join(",");var a=this.currentView.getView().byId("id_area_TrdPart").getTokens();that.GlbCurrView.sTrdPart_area_TokensValues=a.map(function(e){return e.getText()}).join(",");var o=this.currentView.getView().byId("id_country_code_TrdPart").getTokens();that.GlbCurrView.sTrdPart_country_code_TokensValues=o.map(function(e){return e.getText()}).join(",");var n=this.currentView.getView().byId("id_global_group_code_TrdPart").getTokens();that.GlbCurrView.sTrdPart_global_group_code_TokensValues=n.map(function(e){return e.getText()}).join(",");var i=[];if(that.GlbCurrView.sTrdPart_customer_number_TokensValues!==""){var l=that.GlbCurrView.sTrdPart_customer_number_TokensValues.split(",");if(l.length>0){$.each(l,function(e,r){i.push(new sap.ui.model.Filter("customer_number",sap.ui.model.FilterOperator.Contains,r))})}}if(that.GlbCurrView.sTrdPart_TrdPart_company_class_Tokens_Values!==""){var d=that.GlbCurrView.sTrdPart_TrdPart_company_class_Tokens_Values.split(",");if(d.length>0){$.each(d,function(e,r){i.push(new sap.ui.model.Filter("company_class",sap.ui.model.FilterOperator.Contains,r))})}}if(that.GlbCurrView.sTrdPart_area_TokensValues!==""){var u=that.GlbCurrView.sTrdPart_area_TokensValues.split(",");if(u.length>0){$.each(u,function(e,r){i.push(new sap.ui.model.Filter("area",sap.ui.model.FilterOperator.Contains,r))})}}if(that.GlbCurrView.sTrdPart_global_group_code_TokensValues!==""){var s=that.GlbCurrView.sTrdPart_global_group_code_TokensValues.split(",");if(s.length>0){$.each(s,function(e,r){i.push(new sap.ui.model.Filter("global_group_code",sap.ui.model.FilterOperator.Contains,r))})}}if(that.GlbCurrView.sTrdPart_country_code_TokensValues!==""){var c=that.GlbCurrView.sTrdPart_country_code_TokensValues.split(",");if(c.length>0){$.each(c,function(e,r){i.push(new sap.ui.model.Filter("country_code",sap.ui.model.FilterOperator.Contains,r))})}}if(that.startDate!==""&&that.endDate!==""||that.startDate!==undefined&&that.endDate!==undefined){var _=that.startDate;var g=that.endDate;if(_){i.push(new sap.ui.model.Filter("changed_on",sap.ui.model.FilterOperator.BT,_,g))}}if(that.startDate1!==""&&that.endDate1!==""||that.startDate1!==undefined&&that.endDate1!==undefined){var h=that.startDate1;var b=that.endDate1;if(h){i.push(new sap.ui.model.Filter("created_on",sap.ui.model.FilterOperator.BT,h,b))}}that.GlbCurrView.tableMainModelfiltereddata=undefined;that.GlbCurrView.tableMainModelfiltereddata=new e(that.GlbCurrView.getView().getModel("globalMainData_TrdPart").oData);that.GlbCurrView.getView().setModel(that.GlbCurrView.tableMainModelfiltereddata,"TradingPartnerModel");this.getDefaultFilteredDateData();this.currentView.getView().byId("idTrdPartTable").getBinding("items").filter(i);that.GlbCurrView.filteredData=true;that.GlbCurrView.filteredDataToExport=[];var p=this.currentView.getView().byId("idTrdPartTable").getBinding("items").aIndices.length;that.GlbCurrView.filteredIndices=this.currentView.getView().byId("idTrdPartTable").getBinding("items").aIndices;for(var w=0;w<p;w++){that.GlbCurrView.filteredDataToExport.push(that.GlbCurrView.tableMainModelfiltereddata.oData[that.GlbCurrView.filteredIndices[w]])}var m=new e(that.GlbCurrView.filteredDataToExport);that.GlbCurrView.getView().setModel(m,"TradingPartnerModel");that.GlbCurrView.busy.close()},handleTrdPartSortButtonPressedUtil:function(e){if(this.currentView.oInfo_1_SortFrag){this.currentView.oInfo_1_SortFrag=undefined}if(!this.currentView.oInfo_1_SortFrag){that.GlbCurrView.busy.open();this.currentView.oInfo_1_SortFrag=sap.ui.xmlfragment("masterdata.fragments.dialogs.TrdPart.ascAndDscSortTrdPart",that);this.currentView.getView().addDependent(that.GlbCurrView.oInfo_1_SortFrag)}that.GlbCurrView.busy.close();this.currentView.oInfo_1_SortFrag.open()},TrdPart_handleSortDialogConfirmUtil:function(e){var r=this.currentView.byId("idTrdPartTable"),t=e.getParameters(),a=r.getBinding("items"),o,n,i=[];o=t.sortItem.getKey();n=t.sortDescending;i.push(new c(o,n));a.sort(i)},getDefaultFilteredDateData:function(){var e=this.currentView.byId("idTrdPartTable");var r=e.getBinding("items");var t=[];t.push(new c("created_on",true));r.sort(t)}}});